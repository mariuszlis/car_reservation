(()=>{"use strict";"123123"!==localStorage.getItem("token")&&(window.location.href="index.html");var e=document.getElementById("logout"),t=document.querySelector(".dataContainer"),n=document.getElementById("carTypeDropdown"),a=document.getElementById("cars"),c=document.getElementById("form"),o=document.getElementById("confirm"),r=document.getElementById("selectedCarDetails"),l=document.querySelector('#deliveryForm button[type="button"]'),d=document.querySelector('#deliveryForm button[type="submit"]');function i(){var e=c.style.display||"none",t=a.style.display||"block";localStorage.setItem("formState",e),localStorage.setItem("carsState",t)}function m(){var e=document.getElementById("deliveryDate");if(e){var t=new Date,n=new Date(t);n.setDate(t.getDate()+14);var a=n.getFullYear(),c=String(n.getMonth()+1).padStart(2,"0"),o=String(n.getDate()).padStart(2,"0");e.value="".concat(a,"-").concat(c,"-").concat(o)}}function u(){var e=document.getElementById("fullName").value.trim(),t=document.getElementById("deliveryPlace").value.trim(),n=document.getElementById("deliveryDate").value,a=Array.from(document.querySelectorAll('input[name="accessories"]:checked')).map((function(e){return e.value})),c=JSON.parse(localStorage.getItem("formData"))||{};c.fullName=e,c.deliveryPlace=t,c.deliveryDate=n,c.paymentMethod=document.querySelector('input[name="paymentMethod"]:checked')?document.querySelector('input[name="paymentMethod"]:checked').value:null,c.accessories=a,localStorage.setItem("formData",JSON.stringify(c))}document.querySelector(".mainScreen"),window.addEventListener("load",(function(){var e,t;e=localStorage.getItem("formState")||"none",t=localStorage.getItem("carsState")||"block",c.style.display=e,a.style.display=t,function(){var e=localStorage.getItem("selectedCar");if(e){var t=JSON.parse(e),n=t.Price||0;r.innerHTML="\n      <p><strong>".concat(t.Brand," ").concat(t.Model," ").concat(t.Year,'</strong></p>\n      <p id="carPrice">Total Price: ').concat(n," ").concat(t.Currency||"","</p>\n    "),console.log("Loaded selected car:",t)}}(),function(){var e=localStorage.getItem("formData");if(e){var t=JSON.parse(e),n=t.fullName,a=t.deliveryPlace,c=t.deliveryDate,o=t.paymentMethod,r=t.accessories,l=t.totalPrice;if(document.getElementById("fullName").value=n||"",document.getElementById("deliveryPlace").value=a||"",document.getElementById("deliveryDate").value=c||"",c||m(),o){var d=document.querySelector('input[name="paymentMethod"][value="'.concat(o,'"]'));d&&(d.checked=!0)}if(r&&r.length>0&&document.querySelectorAll('input[name="accessories"]').forEach((function(e){r.includes(e.value)&&(e.checked=!0)})),l){var i=document.getElementById("carPrice");i&&(i.textContent="Total Price: ".concat(l))}}}()})),document.getElementById("fullName").addEventListener("input",u),document.getElementById("deliveryPlace").addEventListener("input",u),document.getElementById("deliveryDate").addEventListener("change",u),document.querySelectorAll('input[name="paymentMethod"]').forEach((function(e){e.addEventListener("change",u)})),document.querySelectorAll('input[name="accessories"]').forEach((function(e){e.addEventListener("change",(function(){var e=localStorage.getItem("selectedCar");if(e){var t=JSON.parse(e);!function(e,t){e=Number(e);var n=Array.from(document.querySelectorAll('input[name="accessories"]:checked')),a={"Additional Guarantee":4e3,"Winter Tires":1200},c=e;n.forEach((function(e){c+=Number(a[e.value])})),document.getElementById("carPrice").textContent="Total Price: ".concat(c.toFixed(2)," ").concat(t);var o=JSON.parse(localStorage.getItem("formData"))||{};o.totalPrice=c.toFixed(2),localStorage.setItem("formData",JSON.stringify(o))}(t.Price||0,t.Currency||"")}u()}))})),n.addEventListener("change",(function(e){var n=e.target.value;"X"!==n?fetch("https://db-api-0s2o.onrender.com/cars?type=".concat(n),{method:"GET",mode:"cors"}).then((function(e){if(!e.ok)throw new Error("HTTP error! Status: ".concat(e.status));return e.json()})).then((function(e){console.log("API Response:",e),t.innerHTML="",e.forEach((function(e){var n=document.createElement("div");n.classList.add("carContainer"),n.innerHTML='\n          <div class="carDetails">\n            <h3>'.concat(e.Brand," ").concat(e.Model,"</h3>\n            <p>Year: ").concat(e.Year,"</p>\n            <p>Power: ").concat(e.Power,"</p>\n            <p>Mileage: ").concat(e.Mileage," km</p>\n            <p>Price: ").concat(e.Price," ").concat(e.Currency,'</p>\n            <button class="selectCarBtn">Select</button>\n          </div>\n          <img src="').concat(e.Picture?"data:image/jpeg;base64,".concat(e.Picture):"https://via.placeholder.com/100x100?text=No+Image",'" alt="').concat(e.Brand||"Unknown"," ").concat(e.Model||"Car",'" class="carImage" />\n        '),n.querySelector(".selectCarBtn").addEventListener("click",(function(){!function(e){if(confirm("Please approve Your choice: ".concat(e.Brand," ").concat(e.Model,"?"))){localStorage.setItem("selectedCar",JSON.stringify(e)),a.style.display="none",c.style.display="block",i(),m();var t=e.Price||0;r.innerHTML="\n      <p><strong>".concat(e.Brand," ").concat(e.Model," ").concat(e.Year,'</strong></p>\n      <p id="carPrice">Total Price: ').concat(t," ").concat(e.Currency,"</p>\n    "),console.log("Car selected:",e)}else console.log("Car selection canceled.")}(e)})),t.appendChild(n)}))})).catch((function(e){console.error("Error connecting to the API:",e)})):t.innerHTML=""})),l.addEventListener("click",(function(){document.getElementById("fullName").value="",document.getElementById("deliveryPlace").value="",document.querySelectorAll('input[name="paymentMethod"]').forEach((function(e){e.checked=!1})),document.querySelectorAll('input[name="accessories"]').forEach((function(e){e.checked=!1})),localStorage.removeItem("formData"),c.style.display="none",a.style.display="block",i()})),e.addEventListener("click",(function(){localStorage.setItem("token",""),window.location.href="index.html"})),d.addEventListener("click",(function(t){t.preventDefault();var n=document.getElementById("fullName").value.trim(),r=document.getElementById("deliveryPlace").value.trim(),l=document.getElementById("deliveryDate").value,d=document.querySelector('input[name="paymentMethod"]:checked');if(/^[A-Za-z]+\s[A-Za-z]+$/.test(n))if(r){var i=new Date,m=new Date(l),u=new Date(i);if(u.setDate(i.getDate()+13),m<u)alert("Delivery date must be at least 14 days from today.");else if(d){var s=localStorage.getItem("selectedCar"),y=s?JSON.parse(s):null,g=Array.from(document.querySelectorAll('input[name="accessories"]:checked')).map((function(e){return e.value})),p=(JSON.parse(localStorage.getItem("formData"))||{}).totalPrice||"N/A";a.style.display="none",c.style.display="none",o.style.display="block",o.querySelector("div").innerHTML="\n    <h2>Thank you!</h2>\n    <p>Your delivery has been confirmed.</p>\n    <p><strong>Car:</strong> ".concat(y?"".concat(y.Brand," ").concat(y.Model):"N/A","</p>\n    <p><strong>Total Price:</strong> ").concat(p," ").concat(y&&y.Currency||"","</p>\n    <p><strong>Delivery Date:</strong> ").concat(l||"N/A","</p>\n    <p><strong>Accessories:</strong> ").concat(g.length>0?g.join(", "):"None",'</p>\n    <img src="').concat(y&&y.Picture?"data:image/jpeg;base64,".concat(y.Picture):"https://via.placeholder.com/300x200?text=No+Image",'" alt="').concat(y?"".concat(y.Brand," ").concat(y.Model):"Car",'" style="max-width: 300px; margin-top: 10px;" />\n  '),e.style.display="none",localStorage.clear()}else alert("Please select a Payment Method.")}else alert("Delivery Place is required.");else alert("Please enter a Name and Surname in correct format")}))})();